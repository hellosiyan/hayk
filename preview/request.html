<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-type" content="text/html; charset=utf-8" />
	<title>Hayk Preview</title>
	
	<style type="text/css" media="screen">
		* { padding: 0; margin: 0; outline: 0; font-family: sans-serif; }
		body, html { background: #fff; }
		label { display: block; }
	</style>
	
	<script src="hayk.js" type="text/javascript" language="javascript" charset="utf-8"></script>
	<script src="jquery.min.js" type="text/javascript" language="javascript" charset="utf-8"></script>
	<script type="text/javascript" language="javascript" charset="utf-8">
		jQuery(function($){
			var pane_cont = $('#pane-cont'),
				pane = $('#pane'),
				stats = {};
			
			var hk = new Hayk({
				connected: function(){
					var channel = hk.subscribe("performance");
					
					channel.addListener(function(data){
						if( typeof stats[data] == 'undefined' ) {
							window.test = stats[data] = $('<li>"' + data + '" получено <span>0</span> пъти</li>').appendTo('#results').find('span').get(0);
							window.test.msg_count = 0;
						}
						
						console.log( stats[data] );
						stats[data].innerHTML =  1 + stats[data].msg_count++;
					});
					
					$('form').submit(function(){
						var num, delay, content,
							th = $(this);
						
						num = parseInt(th.find('input[name=msg_num]').val());
						delay = parseInt(th.find('input[name=msg_delay]').val());
						content = th.find('input[name=msg_cont]').val();
						
						send();
						
						function send() {
							channel.send(content);
							num --;
							if ( num > 0) {
								setTimeout(send, delay);
							} else {
								alert('Готово');
							}
						}
						
						return false;
					});
					
				}
			});
		});
	</script>
</head>
<body>
	<form>
		<label>Брой съобщения: <input name="msg_num" value="100" /></label>
		<label>Интервал на изпращане (ms): <input name="msg_delay" value="100" /></label>
		<label>Съдържание: <input name="msg_cont" value="a" /></label>
		<input type="submit" value="Готово"/>
	</form>
	<ul id="results"></ul>
</body>
</html>
