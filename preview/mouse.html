<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-type" content="text/html; charset=utf-8" />
	<title>Caribou Preview</title>
	
	<style type="text/css" media="screen">
		* { padding: 0; margin: 0; outline: 0; font-family: sans-serif; }
		body, html { background: #fff; }
		#pane-cont { position: relative; margin: 0 auto; width: 600px; height: 300px; border: 1px solid #666; }
		#pane-cont .pointer { display: block; position: absolute; width: 1px; height: 1px; border: 5px solid #000; border-radius: 10px }
		#pane { width: 600px; height: 300px; }
	</style>
	
	<script src="caribou.js" type="text/javascript" language="javascript" charset="utf-8"></script>
	<script src="jquery.min.js" type="text/javascript" language="javascript" charset="utf-8"></script>
	<script type="text/javascript" language="javascript" charset="utf-8">
		jQuery(function($){
			var pane_cont = $('#pane-cont'),
				pane = $('#pane'),
				pointers = {};
			
			var crb = new Caribou({
				connected: function(){
					var draw = crb.subscribe("draw"),
						data_old = {
							x: 0,
							y: 0,
							state: 0
						},
						data = {
							id: Math.round(Math.random()*10240),
							color: 'rgba(' + Math.round(200*Math.random()) + ', ' + Math.round(200*Math.random()) + ', ' + Math.round(200*Math.random()) + ', 1)',
							x: 0,
							y: 0,
							state: 0
						};
					
					draw.addListener(function(data){
						if( typeof pointers[data.id] == 'undefined' ) {
							pointers[data.id] = $('<span class="pointer"></span>').appendTo(pane_cont);
						}
						
						pointers[data.id].css({top: data.y, left: data.x, padding: data.state*5, margin: -5*data.state, 'border-color': data.color});
					});
					
					pane_cont.mousemove(function(e){
						var offset = pane.offset();
						data.x = e.pageX - offset.left;
						data.y = e.pageY - offset.top;
					}).mousedown(function(){
						data.state = 1;
					}).mouseup(function(){
						data.state = 0;
					});
					
					setInterval(function(){
						if( data_old.x == data.x && data_old.y == data.y && data_old.state == data.state ) {
							return;
						}
						
						draw.send(data);
						
						data_old.x = data.x
						data_old.y = data.y
						data_old.state = data.state
					}, 10);
				}
			});
		});
	</script>
</head>
<body>
	<div id="pane-cont">
		<canvas id="pane" width="600" height="300"/>
	</div>
</body>
</html>
